<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Nuswantara Explorer - Fixed Connection</title>
    <style>
        :root {
            --win-blue: #0078d7;
            --bg-main: #ffffff;
            --sidebar-bg: #f3f3f3;
            --border: #d2d2d2;
            --text: #333;
            --taskbar-bg: #f0f0f0;
            --hover: #e5e5e5;
        }

        body.dark-mode {
            --bg-main: #1a1a1a;
            --sidebar-bg: #252525;
            --border: #444;
            --text: #e0e0e0;
            --taskbar-bg: #111;
            --hover: #333;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* --- TOOLBAR --- */
        .toolbar {
            height: 40px; background: var(--bg-main); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 10px; gap: 10px;
        }
        .btn-nav { background: none; border: none; font-size: 1.1rem; cursor: pointer; color: var(--win-blue); }
        .btn-nav:disabled { color: #ccc; cursor: default; }
        .address-bar { 
            flex: 1; border: 1px solid var(--border); padding: 4px 10px; 
            font-size: 0.85rem; color: #666; background: var(--bg-main);
        }
        .search-box {
            width: 250px; border: 1px solid var(--border); padding: 4px 10px;
            display: flex; align-items: center; gap: 8px; background: var(--bg-main);
        }

        /* --- LAYOUT --- */
        .explorer-container { display: flex; flex: 1; overflow: hidden; position: relative; }
        
        .sidebar { 
            width: 230px; background: var(--sidebar-bg); 
            border-right: 1px solid var(--border); font-size: 0.85rem;
            padding-top: 10px;
        }

        .nav-group { 
            margin: 5px 10px 15px 10px; 
            border: 1px solid var(--border); 
            border-radius: 4px;
            overflow: hidden;
        }
        .nav-title { padding: 5px 15px; font-weight: bold; font-size: 0.75rem; color: #666; background: rgba(0,0,0,0.03); }
        .nav-item { 
            padding: 6px 15px; display: flex; align-items: center; 
            gap: 10px; cursor: pointer; transition: 0.1s;
        }
        .nav-item:hover { background: var(--hover); }
        .nav-item.active { background: #cce8ff !important; color: #000 !important; border-left: 3px solid var(--win-blue); }

        .explorer-view { flex: 1; padding: 20px; overflow-y: auto; }

        .view-section-title { font-size: 0.9rem; margin-bottom: 15px; color: var(--win-blue); border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .item-card { display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; padding: 10px; border-radius: 4px; }
        .item-card:hover { background: #cce8ff; }
        .item-icon { font-size: 2.5rem; margin-bottom: 5px; }
        .item-label { font-size: 0.7rem; font-weight: 500; }

        /* --- TASKBAR & POPUP --- */
        .taskbar {
            height: 45px; background: var(--taskbar-bg); border-top: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 10px; z-index: 2000;
        }
        .start-btn {
            background: var(--win-blue); color: #fff; border: none;
            padding: 8px 18px; font-weight: bold; border-radius: 3px; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
        }

        #startMenuPopup {
            display: none; position: fixed; bottom: 50px; left: 10px;
            width: 220px; background: var(--bg-main); border: 2px solid var(--win-blue);
            box-shadow: 0 0 20px rgba(0,0,0,0.3); border-radius: 8px; z-index: 9999;
        }
        .menu-item {
            padding: 12px 15px; font-size: 0.85rem; cursor: pointer;
            display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border);
        }
        .menu-item:hover { background: var(--win-blue); color: #fff; }

        .theme-mode-btn {
            margin-left: auto; cursor: pointer; font-size: 0.85rem;
            display: flex; align-items: center; gap: 5px; color: var(--text);
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="toolbar">
        <div style="display:flex; gap:5px;">
            <button class="btn-nav" id="btnBack" onclick="goBack()" disabled>â¬…</button>
            <button class="btn-nav" id="btnForward" onclick="goForward()" disabled>â¡</button>
        </div>
        <div class="address-bar" id="pathDisp">ğŸ“ This PC > Devices and drives</div>
        <div class="search-box">
            ğŸ” <input type="text" placeholder="Search Index..." oninput="search(this.value)" style="border:none; outline:none; background:none; width:100%; color:inherit;">
        </div>
    </div>

    <div class="explorer-container">
        <div class="sidebar">
            <div class="nav-group">
                <div class="nav-title">Quick access</div>
                <div class="nav-item" id="nav-all" onclick="navigate('apps', 'all', true, this)">â­ All Applications</div>
                <div class="nav-item" onclick="parent.showDashboard()">ğŸ–¥ï¸ Desktop</div>
            </div>

            <div class="nav-group">
                <div class="nav-title">This PC</div>
                <div class="nav-item active" id="nav-root" onclick="navigate('root', 'all', true, this)">ğŸ’» This PC</div>
                <div class="nav-item" id="cat-future" onclick="navigate('apps', 'cat-future', true, this)" style="padding-left:35px;">ğŸ“ Astronomi</div>
                <div class="nav-item" id="cat-human" onclick="navigate('apps', 'cat-human', true, this)" style="padding-left:35px;">ğŸ“ Kemanusiaan</div>
                <div class="nav-item" id="nav-fin" onclick="navigate('apps', 'cat-fin', true, this)" style="padding-left:35px;">ğŸ“ Ekonomi</div>
                <div class="nav-item" id="cat-doc" onclick="navigate('apps', 'cat-doc', true, this)" style="padding-left:35px;">ğŸ“ Arsip Dokumen</div>
                <div class="nav-item" id="cat-tech" onclick="navigate('apps', 'cat-tech', true, this)" style="padding-left:35px;">ğŸ“ Teknologi</div>
                <div class="nav-item" id="cat-time" onclick="navigate('apps', 'cat-time', true, this)" style="padding-left:35px;">ğŸ“ Waktu dan Tanggal</div>
                <div class="nav-item" id="cat-sys" onclick="navigate('apps', 'cat-sys', true, this)" style="padding-left:35px;">ğŸ“ Sistem</div>
                <div class="nav-item" id="cat-edu" onclick="navigate('apps', 'cat-edu', true, this)" style="padding-left:35px;">ğŸ“ Arsip Edukasi</div>
                <div class="nav-item" id="cat-tools" onclick="navigate('apps', 'cat-tools', true, this)" style="padding-left:35px;">ğŸ“ Aplikasi Peralatan</div>
                <div class="nav-item" id="cat-lingo" onclick="navigate('apps', 'cat-lingo', true, this)" style="padding-left:35px;">ğŸ“ Bahasa</div>
                <div class="nav-item" id="cat-culture" onclick="navigate('apps', 'cat-culture', true, this)" style="padding-left:35px;">ğŸ“ Budaya</div>
                <div class="nav-item" id="cat-nature" onclick="navigate('apps', 'cat-nature', true, this)" style="padding-left:35px;">ğŸ“ Alami</div>
                <div class="nav-item" id="cat-blue" onclick="navigate('apps', 'cat-blue', true, this)" style="padding-left:35px;">ğŸ“ Arsip Nilai</div>
            </div>
        </div>

        <div class="explorer-view">
            <div id="driveView">
                <div class="view-section-title">Devices and drives (2)</div>
                <div class="grid-layout">
                    <div class="item-card" onclick="navigate('apps', 'all', true, document.getElementById('nav-all'))">
                        <div class="item-icon">ğŸ’¾</div>
                        <div class="item-label">System (C:)</div>
                    </div>
                    <div class="item-card" onclick="navigate('apps', 'cat-future', true, null)">
                        <div class="item-icon">ğŸ’¾</div>
                        <div class="item-label">Arsip Data (E:)</div>
                    </div>
                </div>
            </div>

            <div id="appView" class="hidden">
                <div class="view-section-title" id="folderTitle">Applications</div>
                <div class="grid-layout" id="appGrid"></div>
            </div>
        </div>
    </div>

    <div id="startMenuPopup">
        <div style="background:var(--win-blue); color:white; padding:10px; font-weight:bold; font-size:0.8rem;">NUSWANTARA EXPLORER</div>
        <div class="menu-item" onclick="location.reload();"><span>ğŸ”„</span> Refresh Explorer</div>
    </div>

    <div class="taskbar">
        <button class="start-btn" onclick="toggleStart()">
            <span>ğŸ’ </span> START
        </button>
        <div class="theme-mode-btn" onclick="toggleTheme()">
            <span id="themeIcon">ğŸŒ“</span> Theme Mode
        </div>
    </div>

    <script>
        // Database aplikasi sinkron dengan index.html
      const appDatabase = [
    { url: 'Readme.html', label: 'Tentang', icon: 'â„¹ï¸', cat: 'cat-blue' },
    { url: 'kesetaraan harga emas perak.html', label: 'Kesetaraan Harga Emas dan Perak', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'kesetaraan nilai.html', label: 'Kesetaraan Nilai', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'persamaan nilai komoditas.html', label: 'Persamaan Nilai tanpa Alat Tukar', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'kesetaraan harga anti deflasi.html', label: 'Kesetaraan Harga Anti Deflasi', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'protokol uang emas dan perak.html', label: 'Protokol Aturan Uang Emas dan Perak', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'jebakan standar dollar.html', label: 'Jebakan Standar Dolar', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'solusi anti ekonomi elit tanpa dolar.html', label: 'Solusi Ekonomi Elit Tanda Dolar/Fiat', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'jantung ekonomi micro.html', label: 'Jantung Ekonomi Micro', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'protokol ekonomi micro darurat likuiditas.html', label: 'Protokol Ekonomi Micro Darurat', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'nilai dan jasa yang layak emas.html', label: 'Nilai dan Jasa yang Layak di Bayar Emas atau Perak', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'alasan kita jangan jadi konsumen atas uang.html', label: '50 Alasan kita jangan sampai jadi Konsumen atas Uang', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'gerakan ekonomi rakyat.html', label: '50 Gerakan Ekonomi Rakyat', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'solusi ekonomi rakyat.html', label: '50 Solusi Ekonomi Rakyat', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'panduan kedaulatan ekonomi mikro dengan uang receh.html', label: '50 Panduan Kedaulatan Ekonomi Mikro dengan uang Receh', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'panduan bebas finansial real.html', label: '50 Panduan Bebas Finansial Real', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'protokol audit harga wajar tolak m2.html', label: '50 Protokol Audit Harga Wajar Tolak M2', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'restorasi mundur ke abad awal milenium.html', label: '50 Restorasi Mundur ke Abad Awal Milenium', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'kuliner 90an dan rutinitasnya.html', label: '50 Kuliner 90an dan Rutinitasnya.html', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: 'survival kit 90s dan sumber ekonomi anak.html', label: '50 Survival kit 90s dan Sumber ekonomi Anak', icon: 'ğŸ“', cat: 'cat-blue' },
    { url: '01 Jam Sunda Nuswantara.html', label: 'Jam Utama', icon: 'ğŸ•', cat: 'cat-time' },
    { url: '02. Kalender Sunda Nuswantara.html', label: 'Kalender', icon: 'ğŸ“…', cat: 'cat-time' },
    { url: '03. Jadwal Shalat Sunda Nuswantara.html', label: 'Shalat', icon: 'ğŸ•Œ', cat: 'cat-culture' },
    { url: '04. Converter Waktu & Tanggal Ke Sunda Nuswantara.html', label: 'Konverter', icon: 'ğŸ”„', cat: 'cat-tools' },
    { url: '05. Satuan Nilai Sunda Nuswantara.html', label: 'Satuan Nilai', icon: 'âš–ï¸', cat: 'cat-edu' },
    { url: '06. Contoh Jadwal Kegiatan Sunda Nuswantara.html', label: 'Jadwal', icon: 'ğŸ“', cat: 'cat-edu' },
    { url: '07. Panduan Manual Contoh Pertanian.html', label: 'Lumbung', icon: 'ğŸŒ¾', cat: 'cat-fin' },
    { url: '08. Panduan Manual Contoh Produktifitas dan Karya.html', label: 'Karya', icon: 'ğŸ”¨', cat: 'cat-fin' },
    { url: '09. Aksara Hanacaraka.html', label: 'Hanacaraka', icon: 'ê¦²', cat: 'cat-lingo' },
    { url: '10. Aksara Sunda Kuno.html', label: 'Sunda Kuno', icon: 'á®Š', cat: 'cat-lingo' },
    { url: '11. Rekonstruksi Bahasa Sunda Kuno.html', label: 'Kamus', icon: 'ğŸ“–', cat: 'cat-lingo' },
    { url: '12. Sunda Kuno.html', label: 'Olaxara', icon: 'âœ’ï¸', cat: 'cat-lingo' },
    { url: 'Tools.html', label: 'Logic Engine', icon: 'ğŸ§ ', cat: 'cat-lingo' },
    { url: '13. Kumpulan Renungan.html', label: 'Renungan', icon: 'ğŸ“š', cat: 'cat-edu' },
    { url: '14. Terapi Cahaya Malam.html', label: 'Terapi Sirep', icon: 'ğŸ•¯ï¸', cat: 'cat-tech' },
    { url: '15. Appraisal Scanner.html', label: 'Appraisal', icon: 'ğŸ”', cat: 'cat-edu' },
    { url: '16. Restorasi Pangan.html', label: 'Teknologi Pangan', icon: 'ğŸ¯', cat: 'cat-edu' },
    { url: '17. Restorasi Arsitektur.html', label: 'Arsitektur', icon: 'ğŸ›–', cat: 'cat-edu' },
    { url: '18. Restorasi Kesehatan.html', label: 'Tabib Digital', icon: 'ğŸŒ¿', cat: 'cat-edu' },
    { url: '19. Restorasi Wastra.html', label: 'Wastra Alam', icon: 'ğŸ§¶', cat: 'cat-nature' },
    { url: '20. Restorasi Sosial.html', label: 'Balai Warga', icon: 'ğŸ¤', cat: 'cat-human' },
    { url: '21. Pustaka Peradaban.html', label: 'Leveling Diri', icon: 'â«', cat: 'cat-human' },
    { url: '23. Scanner Nilai Dasar.html', label: 'Analisa Dasar', icon: 'ğŸ”', cat: 'cat-edu' },
    { url: '24. Estafet Kemanusiaan.html', label: 'Codex Manusia', icon: 'ğŸ‘¤', cat: 'cat-human' },
    { url: '25. Menu Ekonomi.html', label: 'Ekonomi Nilai', icon: 'ğŸ’°', cat: 'cat-fin' },
    { url: '26. Menu Masa Depan.html', label: 'Realitas & Masa Depan', icon: 'ğŸ’Š', cat: 'cat-fin' },
    { url: '27. Menu Hukum Syariat dan Hakikat.html', label: 'Syariat & Hakikat', icon: 'âš–ï¸', cat: 'cat-culture' },
    { url: '28. Indikator Iman.html', label: 'Iman Metric', icon: 'ğŸ“¶', cat: 'cat-culture' },
    { url: '29. Pustaka Ajaran Tauhid.html', label: 'Pustaka Ajaran Tauhid', icon: 'ğŸ“„', cat: 'cat-culture' },
    { url: '30. Quantum Vitality.html', label: 'Quantum Vitality', icon: 'âš›ï¸', cat: 'cat-human' },
    { url: '31. Holistic Calibration.html', label: 'Holistic Radar', icon: 'ğŸ“¡', cat: 'cat-human' },
    { url: '32. Legacy Hub.html', label: 'Warisan Generasi', icon: 'ğŸŒ³', cat: 'cat-human' },
    { url: '33. Civilization Hub.html', label: 'Civilization Hub', icon: 'ğŸŒ', cat: 'cat-human' },
    { url: '34.Nusantara Auto-Anchor (POS Mode).html', label: 'Auto-Anchor POS', icon: 'âš“', cat: 'cat-fin' },
    { url: '35.Nusantara Savings Simulator.html', label: 'Simulasi Tabungan', icon: 'ğŸ’°', cat: 'cat-fin' },
    { url: '36.Nusantara Income Generator.html', label: 'Income Generator', icon: 'ğŸ”¨', cat: 'cat-fin' },
    { url: '37. Pusat Strategi Ekonomi.html', label: 'Pusat Strategi Ekonomi', icon: 'ğŸ¤', cat: 'cat-fin' },
    { url: '37. Jam Pasir Timer.html', label: 'Jam Pasir Nusantara', icon: 'â³', cat: 'cat-tools' },
    { url: '38. Kawi Jawa Kuno.html', label: 'Prasasti Jawa Kawi', icon: 'ğŸ—¿', cat: 'cat-lingo' },
    { url: '39. Pagon Mataram.html', label: 'Mesin Ketik Pegon', icon: 'âœ’ï¸', cat: 'cat-culture' },
    { url: '40. Encoder Arsip Keraton.html', label: 'Encoder Arsip Keraton', icon: 'âœ’ï¸', cat: 'cat-lingo' },
    { url: '41. Ancient Astronomy.html', label: 'Ancient Astronomy', icon: 'ğŸ•', cat: 'cat-future' },
    { url: '42. Advanced Systems.html', label: 'Advanced Systems', icon: 'âš›ï¸', cat: 'cat-tech' },
    { url: '43. Forbidden Tech.html', label: 'Forbidden Tech', icon: 'âš›ï¸', cat: 'cat-tech' },
    { url: '44. Gallery.html', label: 'Gallery', icon: 'ğŸ–¼ï¸', cat: 'cat-doc' },
    { url: '45. Media Player.html', label: 'Media Player', icon: 'ğŸµ', cat: 'cat-doc' },
    { url: '46. TV Jadul.html', label: 'TV Jadul', icon: 'ğŸ“º', cat: 'cat-doc' },
    { url: '54. Double Anchor System.html', label: 'Double Anchor System', icon: 'âš–ï¸', cat: 'cat-fin' },
    { url: '55. Nilai Komoditas.html', label: 'Daftar Nilai Komoditas', icon: 'ğŸ“š', cat: 'cat-fin' },
    { url: '56. Sunda Nuswantara Archive.html', label: 'SUNDA NUSWANTARA ARCHIVE', icon: 'ğŸ“–', cat: 'cat-human' },
    { url: '62. Menu Ether Tech.html', label: 'ETHER TECH & BLUEPRINTS', icon: 'âš¡', cat: 'cat-tech' },
    { url: 'kompas.html', label: 'NAVIGASI TAKTIS', icon: 'ğŸ§­', cat: 'cat-tools' },
    { url: 'petajalur.html', label: 'BUAT PETA JALUR', icon: 'ğŸŒ', cat: 'cat-tools' },
    { url: 'DecentralizedID.html', label: 'Cetak Data Personal', icon: 'ğŸ“„', cat: 'cat-sys' },
    { url: 'WAenigma.html', label: 'WAenigma', icon: 'âœ’ï¸', cat: 'cat-sys' },
    { url: 'Picmigma.html', label: 'Picmigma', icon: 'ğŸ”', cat: 'cat-sys' },
    { url: 'morsenigma.html', label: 'Morsenigma', icon: 'ğŸ”Š', cat: 'cat-sys' },
    { url: 'stegavault.html', label: 'Stegavault', icon: 'ğŸ—¿', cat: 'cat-sys' },
    { url: 'sonicmind.html', label: 'Sonicmind', icon: 'ğŸ”Š', cat: 'cat-sys' },
    { url: 'sonicmindtransfer.html', label: 'Sonic Mind Transfer', icon: 'ğŸ”Š', cat: 'cat-sys' },
    { url: 'https://unorganically-flangeless-parthenia.ngrok-free.dev/', label: 'Genesis Chat', icon: 'ğŸ’¬', cat: 'cat-tools' },
    { url: 'genesis manager.html', label: 'Genesis Local File Manager', icon: 'ğŸ“‚', cat: 'cat-tools' },
    { url: 'mtfzonetradingsystem.html', label: 'MTF Zone Trading System', icon: 'ğŸ“ˆ', cat: 'cat-fin' },
    { url: 'Nmail.html', label: 'N-Mail', icon: 'âœ‰ï¸', cat: 'cat-tools' },
    { url: 'SMS.html', label: 'Inbox SMS', icon: 'ğŸ“‚', cat: 'cat-tools' },
    { url: '56. Nuswantara Hub.html', label: 'Nuswantara Hub & Tools', icon: 'ğŸ‘¤', cat: 'cat-tools' },
    { url: 'Bio Medic.html', label: 'Bio Medic Hacking', icon: 'ğŸ’Š', cat: 'cat-tech' },
    { url: 'Khusus Insan Dewasa Baligh.html', label: 'Dewasa Baligh', icon: 'â¤ï¸â€ğŸ”¥', cat: 'cat-human' },
    { url: 'modelmap1.html', label: 'Model Map1', icon: 'ğŸŒ', cat: 'cat-tools' },
    { url: 'modelmap2.html', label: 'Model Map2', icon: 'ğŸŒ', cat: 'cat-tools' },
    { url: 'modelmap3.html', label: 'Model Map3', icon: 'ğŸŒ', cat: 'cat-tools' },
    { url: 'jam kerja dan belajar.html', label: 'Sinkronisasi Jam Kerja dan Belajar', icon: 'ğŸ“–', cat: 'cat-culture' },
    { url: 'jadwal ibadah puasa sunda nuswantara.html', label: 'Sinkronisasi Jam Ibadah Dan Rutinitas Bulan Puasa', icon: 'ğŸ“–', cat: 'cat-culture' },
    { url: 'manual jam sunda nuswantara.html', label: 'Manual Penggunaan Jam Sunda Nuswantara', icon: 'ğŸ“–', cat: 'cat-culture' },
    { url: 'manual kalender nuswantara.html', label: 'Manual Penggunaan Kalender Sunda Nuswantara', icon: 'ğŸ“–', cat: 'cat-culture' },
    { url: 'kalkulator lahan padi.html', label: 'Kalkulator Kebutuhan Lahan Padi', icon: 'ğŸŒ¾', cat: 'cat-edu' },
    { url: 'kalkulator jumlah ternak.html', label: 'Kalkulator Management Ternak', icon: 'ğŸ›–', cat: 'cat-edu' },
    { url: 'kalkulator panen ikan dan sayur.html', label: 'Kalkulator Kebutuhan Protein Ikan dan Sayur', icon: 'ğŸ¯', cat: 'cat-edu' }
      ];

        let historyStack = [{target: 'root', cat: 'all'}];
        let curIdx = 0;

        // FUNGSI UTAMA UNTUK MEMBUKA APLIKASI DI PANEL UTAMA
        function openAppInOS(url, label, icon) {
            // Kita coba berbagai cara untuk mencapai parent.launchApp
            if (typeof parent.launchApp === "function") {
                parent.launchApp(url, label, icon);
            } else if (window.parent && typeof window.parent.launchApp === "function") {
                window.parent.launchApp(url, label, icon);
            } else {
                console.error("Gagal terhubung ke Nuswantara OS utama.");
                window.open(url, '_blank');
            }
        }

        function navigate(target, cat = 'all', push = true, navEl = null) {
            const dv = document.getElementById('driveView');
            const av = document.getElementById('appView');
            const path = document.getElementById('pathDisp');
            const grid = document.getElementById('appGrid');

            if(navEl) {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                navEl.classList.add('active');
            }

            if (target === 'root') {
                dv.classList.remove('hidden'); av.classList.add('hidden');
                path.innerText = "ğŸ“ This PC > Devices and drives";
            } else {
                dv.classList.add('hidden'); av.classList.remove('hidden');
                path.innerText = `ğŸ“ This PC > Apps > ${cat}`;
                grid.innerHTML = "";
                const filtered = cat === 'all' ? appDatabase : appDatabase.filter(a => a.cat === cat);
                filtered.forEach(app => {
                    grid.innerHTML += `<div class="item-card" onclick="openAppInOS('${app.url}','${app.label}','${app.icon}')">
                        <div class="item-icon">${app.icon}</div><div class="item-label">${app.label}</div>
                    </div>`;
                });
            }

            if (push) {
                historyStack = historyStack.slice(0, curIdx + 1);
                historyStack.push({target, cat});
                curIdx++;
            }
            updateBtns();
        }

        function goBack() { 
            if(curIdx > 0) { 
                curIdx--; 
                let s = historyStack[curIdx]; 
                let el = (s.target === 'root') ? document.getElementById('nav-root') : null;
                navigate(s.target, s.cat, false, el); 
            } 
        }

        function goForward() { 
            if(curIdx < historyStack.length - 1) { 
                curIdx++; 
                let s = historyStack[curIdx]; 
                navigate(s.target, s.cat, false); 
            } 
        }
        
        function updateBtns() {
            document.getElementById('btnBack').disabled = curIdx === 0;
            document.getElementById('btnForward').disabled = curIdx === historyStack.length - 1;
        }

        function toggleStart() {
            const m = document.getElementById('startMenuPopup');
            m.style.display = (m.style.display === 'block') ? 'none' : 'block';
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeIcon').innerText = isDark ? 'â˜€ï¸' : 'ğŸŒ“';
        }

        function search(q) {
            if(q.length > 0) navigate('apps', 'all', false);
            document.querySelectorAll('.item-card').forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(q.toLowerCase()) ? 'flex' : 'none';
            });
        }

        window.addEventListener('click', (e) => {
            if (!e.target.closest('.start-btn') && !e.target.closest('#startMenuPopup')) {
                document.getElementById('startMenuPopup').style.display = 'none';
            }
        });
    </script>
</body>
</html>
















