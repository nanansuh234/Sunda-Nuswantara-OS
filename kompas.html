<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigasi Taktis Jelas - Nuswantara OS</title>
    <style>
        /* --- STYLE DASAR --- */
        body {
            background-color: #050505;
            color: #00ff88;
            font-family: 'Consolas', 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; text-align: center; overflow-x: hidden;
        }
        
        #pc-warning { 
            display: none; background: #330000; border: 1px solid red; color: #ffcccc; 
            padding: 10px; margin: 20px; font-size: 0.8rem; 
        }

        #start-btn {
            padding: 20px 40px; font-size: 1.2rem; background: #001a0d; color: #00ff88;
            border: 2px solid #00ff88; cursor: pointer; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            border-radius: 4px;
        }

        .compass-ui { display: none; width: 100%; max-width: 400px; }

        /* --- CINCIN KOMPAS --- */
        .compass-ring {
            width: 280px; height: 280px; margin: 0 auto 20px;
            border: 4px solid #333; border-radius: 50%; position: relative;
            background: #000;
            box-shadow: 0 0 25px rgba(0,255,136,0.1);
            overflow: hidden;
        }

        /* Container yang berputar (Piringan) */
        #rotating-container {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            transition: transform 0.1s linear;
        }

        /* Label Arah di Piringan */
        .north-label { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: #ff3333; font-weight: 900; font-size: 1.5rem; z-index: 5; }
        .other-labels { position: absolute; color: #00ff88; font-weight: bold; font-size: 1.2rem; z-index: 5; }

        /* Garis-garis Dekorasi */
        .tick-marks {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-conic-gradient(from 0deg, rgba(0, 255, 136, 0.4) 0deg 1deg, transparent 1deg 15deg);
            mask: radial-gradient(transparent 65%, black 66%); -webkit-mask: radial-gradient(transparent 65%, black 66%);
        }

        /* Jarum Merah (Diam) */
        .static-needle {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%); z-index: 10;
        }
        .static-needle::after {
            content: ''; display: block; 
            border-top: 20px solid #ff3333;
            border-left: 10px solid transparent; 
            border-right: 10px solid transparent; 
            filter: drop-shadow(0 0 5px #ff0000);
        }

        /* --- INFO PANEL --- */
        .hud-data { 
            border-top: 1px solid #333; 
            padding-top: 15px; width: 90%; margin: auto; 
        }
        
        .big-deg { 
            font-size: 3rem; font-weight: bold; color: #fff; margin: 0; 
            text-shadow: 0 0 10px #00ff88;
        }
        
        /* Arah Mata Angin Full Text */
        .cardinal-text { 
            font-size: 1.2rem; color: #00ff88; margin-bottom: 20px; 
            font-weight: bold; letter-spacing: 1px; text-transform: uppercase;
        }
        
        /* Tabel GPS Rinci */
        .gps-box {
            background: #111;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            font-size: 0.9rem;
            display: grid;
            gap: 10px;
        }
        
        .gps-row {
            display: flex; justify-content: space-between;
            border-bottom: 1px solid #222;
            padding-bottom: 5px;
        }
        .gps-row:last-child { border-bottom: none; }
        
        .gps-label { color: #888; font-size: 0.8rem; }
        .gps-val { color: #fff; font-weight: bold; font-family: monospace; }

        .back-btn { 
            margin-top: 30px; display: inline-block; text-decoration: none; 
            color: #666; font-size: 0.9rem; border: 1px solid #333; padding: 8px 20px; 
            transition: 0.3s;
        }
        .back-btn:hover { color: #00ff88; border-color: #00ff88; }
    </style>
</head>
<body>

    <div id="pc-warning">⚠️ WARNING: Sensor tidak terdeteksi di Laptop/PC. Buka di HP.</div>

    <button id="start-btn" onclick="initSystem()">AKTIFKAN SENSOR</button>

    <div class="compass-ui" id="ui-panel">
        
        <div class="compass-ring">
            <div class="static-needle"></div>
            
            <div id="rotating-container">
                <div class="north-label">U</div> <div class="other-labels" style="top: 50%; right: 15px; transform: translateY(-50%);">T</div>
                <div class="other-labels" style="bottom: 15px; left: 50%; transform: translateX(-50%);">S</div>
                <div class="other-labels" style="top: 50%; left: 15px; transform: translateY(-50%);">B</div>
                <div class="tick-marks"></div>
            </div>
        </div>

        <div class="hud-data">
            <div class="big-deg" id="degree-display">0°</div>
            <div class="cardinal-text" id="cardinal-display">MENUNGGU...</div>

            <div class="gps-box">
                <div class="gps-row">
                    <span class="gps-label">GARIS LINTANG (LAT)</span>
                    <span id="lat-val" class="gps-val">Mencari...</span>
                </div>
                <div class="gps-row">
                    <span class="gps-label">GARIS BUJUR (LON)</span>
                    <span id="lon-val" class="gps-val">Mencari...</span>
                </div>
                <div class="gps-row">
                    <span class="gps-label">KETINGGIAN (ALT)</span>
                    <span id="alt-val" class="gps-val">--</span>
                </div>
                <div class="gps-row">
                    <span class="gps-label">AKURASI SINYAL</span>
                    <span id="acc-val" class="gps-val">--</span>
                </div>
            </div>
        </div>
        
        <a href="index.html" class="back-btn"><< KEMBALI KE OS</a>
    </div>

    <script>
        // Cek apakah dibuka di PC
        if (!window.DeviceOrientationEvent) document.getElementById('pc-warning').style.display = 'block';

        function initSystem() {
            // Izin sensor untuk iPhone/iOS
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(res => {
                        if (res === 'granted') startCompass();
                        else alert("Izin sensor ditolak!");
                    })
                    .catch(alert);
            } else {
                startCompass();
            }
        }

        function startCompass() {
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('ui-panel').style.display = 'block';
            
            // Aktifkan GPS
            startGPS();

            // Aktifkan Sensor Arah (Logic Horizontal)
            if ('ondeviceorientationabsolute' in window) {
                // Android Modern
                window.addEventListener('deviceorientationabsolute', handleOrientation);
            } else {
                // iOS & Android Lama
                window.addEventListener('deviceorientation', handleOrientation);
            }
        }

        function handleOrientation(e) {
            let heading = 0;

            if (e.webkitCompassHeading) {
                // Khusus iOS
                heading = e.webkitCompassHeading;
            } else if (e.alpha !== null) {
                // Khusus Android (Perlu dibalik rumusnya)
                heading = 360 - e.alpha; 
                if (heading < 0) heading += 360; 
            } else {
                return; 
            }

            updateUI(heading);
        }

        function updateUI(deg) {
            // Putar visual kompas berlawanan arah HP
            document.getElementById('rotating-container').style.transform = `rotate(${-deg}deg)`;

            // Update Angka Derajat
            let d = Math.round(deg);
            document.getElementById('degree-display').innerText = `${d}°`;
            
            // Update Teks Arah (8 Mata Angin Saja)
            document.getElementById('cardinal-display').innerText = getCardinal(d);
        }

        function getCardinal(deg) {
            // Normalisasi
            deg = deg % 360;
            
            // Logic 8 Arah (Standar)
            // Tiap arah punya cakupan 45 derajat (22.5 kiri + 22.5 kanan)
            if (deg >= 337.5 || deg < 22.5) return "UTARA";
            if (deg >= 22.5 && deg < 67.5) return "TIMUR LAUT";
            if (deg >= 67.5 && deg < 112.5) return "TIMUR";
            if (deg >= 112.5 && deg < 157.5) return "TENGGARA";
            if (deg >= 157.5 && deg < 202.5) return "SELATAN";
            if (deg >= 202.5 && deg < 247.5) return "BARAT DAYA";
            if (deg >= 247.5 && deg < 292.5) return "BARAT";
            if (deg >= 292.5 && deg < 337.5) return "BARAT LAUT";
            
            return "";
        }

        function startGPS() {
            if ("geolocation" in navigator) {
                navigator.geolocation.watchPosition(
                    pos => {
                        // Tampilkan 6 angka di belakang koma biar presisi
                        document.getElementById('lat-val').innerText = pos.coords.latitude.toFixed(6);
                        document.getElementById('lon-val').innerText = pos.coords.longitude.toFixed(6);
                        
                        // Ketinggian (MDPL - Meter Diatas Permukaan Laut)
                        let alt = pos.coords.altitude ? Math.round(pos.coords.altitude) + " MDPL" : "Tidak Terdeteksi";
                        document.getElementById('alt-val').innerText = alt;

                        // Akurasi
                        let acc = pos.coords.accuracy ? "±" + Math.round(pos.coords.accuracy) + " Meter" : "--";
                        document.getElementById('acc-val').innerText = acc;
                    },
                    err => {
                        console.log("GPS Error");
                        document.getElementById('lat-val').innerText = "Gagal Mengambil Lokasi";
                    }, 
                    { enableHighAccuracy: true, maximumAge: 0 }
                );
            } else {
                document.getElementById('lat-val').innerText = "GPS Tidak Support";
            }
        }
    </script>
</body>
</html>
